<domain xmlns:qemu="http://libvirt.org/schemas/domain/qemu/1.0" type="kvm">
    <name>@VM_NAME@</name>
    <memory unit="G">16</memory>  <!-- Utilize realistic memory amounts, such as 8, 16, 32, and 64. -->
    <currentMemory unit="G">16</currentMemory>
    <vcpu placement="static">@TOTAL_NUMBER_OF_CORES@</vcpu>

  <os>
    <type arch="x86_64" machine="pc-q35-10.2">hvm</type>
    <loader readonly="yes" secure="yes" type="pflash" format="qcow2">/opt/Hypervisor-Phantom/firmware/OVMF_CODE.qcow2</loader>
    <nvram template="/opt/Hypervisor-Phantom/firmware/OVMF_VARS.qcow2" format="qcow2"></nvram>
    <bootmenu enable="yes"/>
    <smbios mode="host"/> <!-- Remove if 'smbios.bin' is being passed through -->
  </os>

    <features>
        <acpi/>
        <apic/>
        <!-- Disable all enlightenments if Hyper-V method is NOT used.
        Enlightenments on "bare-metal" are flagged / extremely suspicious! -->
        <hyperv mode="custom">
            <relaxed state="off"/>
            <vapic state="off"/>
            <spinlocks state="off"/>
            <vpindex state="off"/>
            <runtime state="off"/>
            <synic state="off"/>
            <stimer state="off"/>
            <reset state="off"/>
            <vendor_id state="on" value="GenuineIntel"/> <!-- KVM patch NOT present | Apply to fix NVIDIA (Code 43) error -->
            <frequencies state="off"/>
            <reenlightenment state="off"/>
            <tlbflush state="off"/>
            <ipi state="off"/>
            <evmcs state="off"/>
            <avic state="off"/>
            <emsr_bitmap state="off"/>
            <xmm_input state="off"/>
        </hyperv>
        <kvm>
            <hidden state="on"/> <!-- Hide the KVM hypervisor from standard MSR based discovery (CPUID Bitset) -->
        </kvm>
        <pmu state="off"/>
        <vmport state="off"/> <!-- Disables the emulation of VMware IO port, for vmmouse etc. ACE AC "virtual machine prompt" will appear if not disabled -->
        <smm state="on"/>
        <ioapic driver="kvm"/>
        <msrs unknown="fault"/>
    </features>

    <cpu mode="host-passthrough" check="none" migratable="on">
        <topology sockets="1" dies="1" clusters="1" cores="@NUMBER_OF_CORES@" threads="@NUMBER_OF_THREADS@"/>
        <cache mode="passthrough"/>
        <maxphysaddr mode="passthrough"/>
       
        <!-- Performance Features -->
        <feature policy="require" name="svm"/>
        <feature policy="require" name="topoext"/>
        <feature policy="require" name="invtsc"/>
       
        <!-- Hypervisor Detection -->
        <feature policy="disable" name="hypervisor"/> <!-- Prevents detection of running under a hypervisor -->
       
        <!-- Speculative Execution Mitigations -->
        <feature policy="disable" name="ssbd"/>       <!-- Disables Speculative Store Bypass Disable flag -->
        <feature policy="disable" name="amd-ssbd"/>   <!-- Disables AMD's Speculative Store Bypass Disable flag -->
        <feature policy="disable" name="virt-ssbd"/>  <!-- Disables virtualized speculative store bypass mitigation -->
       
        <!-- Timing Features -->
        <feature policy="disable" name="rdtscp"/>     <!-- Disables the RDTSCP instruction (Use if using patched kernel) -->
      </cpu>

    <clock offset="localtime">
        <timer name="tsc" present="yes" tickpolicy="discard" mode="native"/>
        <!-- obviously only present in VMs -->
        <timer name="kvmclock" present="no"/>
        <timer name="hypervclock" present="no"/>
    </clock>

    <pm>
        <suspend-to-mem enabled="yes"/>
        <suspend-to-disk enabled="yes"/>
    </pm>

    <devices>
        <emulator>/opt/Hypervisor-Phantom/emulator/bin/qemu-system-x86_64</emulator>
        <input type="mouse" bus="ps2"/>
        <input type="keyboard" bus="ps2"/>
        <tpm model="tpm-tis">
            <backend type="emulator" version="2.0"/>
        </tpm>
        <audio id="1" type="none"/>
        <video>
            <model type="none"/>
        </video>
        <watchdog model="itco" action="reset"/>
        <memballoon model="none"/>
        <interface type="network">
            <mac address="e0:73:e7:e0:73:e7"/>
            <source network="default"/>
            <model type="e1000e"/>
            <link state="up"/>
            <address type="pci" domain="0x0000" bus="0x01" slot="0x00" function="0x0"/>
        </interface>
        <shmem name="looking-glass">
            <model type="ivshmem-plain"/>
            <size unit="M">32</size>
            <address type="pci" domain="0x0000" bus="0x10" slot="0x02" function="0x0"/>
        </shmem>
    </devices>

    <qemu:override>
      <qemu:device alias="sata0-0-0">
        <qemu:frontend>
          <qemu:property name="rotation_rate" type="unsigned" value="1"/>
          <qemu:property name="discard_granularity" type="unsigned" value="0"/>
        </qemu:frontend>
      </qemu:device>
    </qemu:override>
</domain>





